<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Epic Grocery Store</title>
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #27ae60;
      --secondary: #f7ca18;
      --bg: #f4f4f4;
      --white: #fff;
      --dark: #222; 
      --shadow: 0 4px 16px rgba(0,0,0,0.08);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: var(--bg);
      color: var(--dark);
    }
    header {
      position: sticky;
      top: 0;
      background: var(--white);
      box-shadow: var(--shadow);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
    }
    .logo {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      letter-spacing: 2px;
      display: flex;
      align-items: center;
    }
    .logo i {
      margin-right: 8px;
    }
    nav a {
      color: var(--dark);
      text-decoration: none;
      margin: 0 1rem;
      font-weight: 500;
      transition: color 0.2s;
    }
    nav a:hover {
      color: var(--primary);
    }
    .search-bar {
      flex: 1;
      margin: 0 2rem;
      display: flex;
      align-items: center;
    }
    .search-bar input {
      width: 100%;
      padding: 0.5rem 1rem;
      border: 2px solid var(--primary);
      border-radius: 20px;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.2s;
    }
    .contact-info {
      font-size: 0.95rem;
      color: var(--primary);
      margin-left: 1.5rem;
      text-align: right;
    }
    .container {
      display: flex;
      max-width: 1200px;
      margin: 2rem auto;
      gap: 2rem;
    }
    aside {
      width: 220px;
      background: var(--white);
      border-radius: 16px;
      box-shadow: var(--shadow);
      padding: 1.5rem 1rem;
      min-height: 450px;
      position: sticky;
      top: 90px;
      height: fit-content;
    }
    aside h3 {
      margin-top: 0;
      color: var(--primary);
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    .categories-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .categories-list li {
      margin-bottom: 1rem;
      cursor: pointer;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      transition: background 0.2s, color 0.2s;
    }
    .categories-list li:hover, .categories-list li.active {
      background: var(--primary);
      color: var(--white);
    }
        .cart-button {
      margin-top: 2rem;
      width: 100%;
      background: var(--primary);
      color: var(--white);
      padding: 0.7rem 1rem;
      border: none;
      border-radius: 20px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.3s ease;
      text-align: center;
    }

    .cart-button:hover {
      background: #1e7f43;
    }
    main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    .hero {
      background: linear-gradient(90deg, var(--primary) 60%, var(--secondary) 100%);
      color: var(--white);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 2.5rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
      animation: fadeIn 1s;
    }
    .hero-content {
      z-index: 1;
    }
    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .hero p {
      font-size: 1.2rem;
      margin-bottom: 1.5rem;
    }
    .hero .cta-btn {
      background: var(--white);
      color: var(--primary);
      border: none;
      padding: 0.8rem 2rem;
      font-size: 1.1rem;
      border-radius: 24px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background 0.2s, color 0.2s;
    }
    .hero .cta-btn:hover {
      background: var(--secondary);
      color: var(--dark);
    }
    .hero-img {
      width: 230px;
      height: 230px;
      background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=400&q=80') center/cover no-repeat;
      border-radius: 50%;
      border: 8px solid var(--white);
      box-shadow: var(--shadow);
      position: absolute;
      right: 2rem;
      top: 50%;
      transform: translateY(-50%);
      z-index: 0;
      animation: float 2.5s infinite alternate;
    }
    @keyframes float {
      0% { transform: translateY(-50%) scale(1);}
      100% { transform: translateY(-54%) scale(1.04);}
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .profile-container {
  position: relative;
  display: inline-block;
  margin-left: 2%;
}

.profile-icon {
  width: 40px;
  height: 40px;
  cursor: pointer;
  border-radius: 50%;
  transition: transform 0.2s;
}

.profile-icon:hover {
  transform: scale(1.1);
}

.profile-info {
  display: none;
  position: absolute;
  top: 50px;
  right: 0;
  background-color: white;
  color: #333;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  width: 220px;
  z-index: 1000;
}

.profile-info p {
  margin: 6px 0;
  font-size: 14px;
}
    .section-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 1rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1.5rem;
    }
    .product-card {
      background: var(--white);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 1.2rem 1rem;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
      overflow: hidden;
      min-height: 300px;
    }
    .product-card:hover {
      transform: translateY(-6px) scale(1.03);
      box-shadow: 0 8px 32px rgba(39, 174, 96, 0.1);
    }
    .product-card img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 14px;
      margin-bottom: 0.7rem;
      user-select: none;
      pointer-events: none;
    }
    .product-card h4 {
      margin: 0 0 0.5rem 0;
      font-size: 1.1rem;
      color: var(--dark);
    }
    .price {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.1rem;
      margin: 0.3rem 0 1rem 0;
      letter-spacing: 0.5px;
    }
    .button-group {
      display: flex;
      gap: 0.5rem;
      margin-top: auto;
      width: 100%;
    }

    .add-btn,
    .order-btn {
      flex: 1;
      border: none;
      padding: 0.5rem;
      font-size: 0.95rem;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease;
      text-align: center;
    }

    .add-btn {
      background: var(--primary);
      color: var(--white);
    }

    .add-btn:hover {
      background: #1e7f43;
    }

    .order-btn {
      background: var(--secondary);
      color: var(--dark);
    }

    .order-btn:hover {
      background: #ffae00; /* Customize this if needed */
    }  

    #budgetResults {
      background: #fff;
      border-radius: 14px;
      padding: 1rem;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      margin-top: 2rem;
      max-height: 300px;
      overflow-y: auto;
    }

    #budgetResults h3 {
      margin-top: 0;
      color: var(--primary);
    }

    /* Filter Container - Professional Design */
    .filter-container {
      position: fixed;
      top: 90px; /* Positioned below profile */
      right: 30px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }

    /* Filter Button */
    #filterBtn {
      background: #ffffff;
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #filterBtn:hover {
      background: #f5f5f5;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    #filterBtn:active {
      transform: translateY(0);
    }

    .filter-icon {
      width: 22px;
      height: 22px;
      filter: invert(48%) sepia(79%) saturate(1180%) hue-rotate(87deg) brightness(98%) contrast(91%);
    }

    /* Filter Dropdown */
    .filter-dropdown {
      position: absolute;
      top: 54px; /* Below the button */
      right: 0;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      padding: 20px;
      width: 260px;
      display: none;
      z-index: 1001;
      animation: fadeIn 0.25s ease-out forwards;
      border: 1px solid rgba(0, 0, 0, 0.05);
      transform-origin: top right;
    }

    .filter-dropdown.show {
      display: block;
    }

    /* Price Filter Section */
    .price-filter {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .price-filter h4 {
      margin: 0;
      color: #2d3748;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: 0.2px;
      padding-bottom: 4px;
      border-bottom: 1px solid #f0f0f0;
    }

    .price-range {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .price-range label {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.2s ease;
      font-size: 14px;
      color: #4a5568;
      font-weight: 500;
    }

    .price-range label:hover {
      background: #f8f9fa;
      transform: translateX(2px);
    }

    .price-range input[type="radio"] {
      width: 16px;
      height: 16px;
      accent-color: #4CAF50;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .price-range input[type="radio"]:checked + span {
      color: #2d3748;
      font-weight: 600;
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.95) translateY(-8px);
      }
      to {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }

    /* Responsive Considerations */
    @media (max-width: 768px) {
      .filter-container {
        right: 20px;
        top: 80px;
      }
      
      .filter-dropdown {
        width: 240px;
        right: -10px;
      }
    }

      .stock-status {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
  }
  .in-stock {
    background-color: #27ae60;
    color: white;
  }
  .out-of-stock {
    background-color: #e74c3c;
    color: white;
  }
  .low-stock {
    background-color: #f39c12;
    color: white;
  }
  .disabled-btn {
    opacity: 0.6;
    cursor: not-allowed;
    pointer-events: none;
  }

    footer {
      background: var(--primary);
      color: var(--white);
      text-align: center;
      padding: 1.5rem 0 1rem 0;
      margin-top: 3rem;
      border-radius: 18px 18px 0 0;
      font-size: 1rem;
    }
    @media (max-width: 900px) {
      .container { flex-direction: column; gap: 0; }
      aside { width: 100%; position: static; min-height: unset; margin-bottom: 2rem;}
      .hero-img { display: none; }
      .hero { flex-direction: column; align-items: flex-start; padding: 2rem 1rem;}
    }
    @media (max-width: 600px) {
      header { flex-direction: column; padding: 1rem;}
      .search-bar { margin: 1rem 0;}
      nav { margin: 1rem 0;}
      .container { padding: 0 0.5rem;}
    }
  </style>
</head>
<body>

<header>
  <div class="logo"><i>üõí</i>OPEN SHOP</div>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search Product...">
  </div>
  <nav>
    <a href="#">Home</a>
    <a href="#">Shop</a>
    <a href="#">Contact Us</a>
  </nav>
  <div class="contact-info">
    <div>Call: +1300909098</div>
    <div>Email: info@gmail.com</div>
  </div>

  <div class="profile-container">
  <img src="https://cdn-icons-png.flaticon.com/512/1077/1077063.png" alt="Profile" class="profile-icon" onclick="toggleProfile()" />
  <div id="profileInfo" class="profile-info">
    <p><strong>Name:</strong> <span id="profileName">Guest</span></p>
    <p><strong>ID:</strong> <span id="profileID">N/A</span></p>
    <p><strong>Email:</strong> <span id="profileEmail">Not Logged In</span></p>
  </div>
</div>
</header>

<div class="filter-container">
  <button id="filterBtn" title="Filter Options">
    <img src="https://img.icons8.com/ios-filled/50/4CAF50/filter--v1.png" class="filter-icon">
  </button>
  <div class="filter-dropdown">
    <div class="price-filter">
      <h4>Filter by Price</h4>
      <div class="price-range">
        <label>
          <input type="radio" name="priceFilter" value="all" checked> All Prices
        </label>
        <label>
          <input type="radio" name="priceFilter" value="0-50"> Under ‚Çπ50
        </label>
        <label>
          <input type="radio" name="priceFilter" value="50-100"> ‚Çπ50 - ‚Çπ100
        </label>
        <label>
          <input type="radio" name="priceFilter" value="100-150"> ‚Çπ100 - ‚Çπ150
        </label>
        <label>
          <input type="radio" name="priceFilter" value="150-200"> ‚Çπ150 - ‚Çπ200
        </label>
        <label>
          <input type="radio" name="priceFilter" value="200+"> Above ‚Çπ200
        </label>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <aside>
    <h3>Categories</h3>
    <ul class="categories-list" id="categoryList">
      <li class="active" data-category="all">All</li>
      <li data-category="grains">Grains & Staples</li>
      <li data-category="spices">Spices & Condiments</li>
      <li data-category="veggies">Vegetables & Fruits</li>
      <li data-category="dairy">Dairy & Protein</li>
      <li data-category="other">Other Essentials</li>
    </ul>
    <!-- Cart Button -->
    <button id="goToCartBtn", class="cart-button">Go to Cart</button>
    <button id="goToBudget" class="cart-button">Budget</button>    
  </aside>


  <main>
    <section class="hero">
      <div class="hero-content">
        <h1>Nature at Your doorStep</h1>
        <p>Shop Smart: Free Delivery + Daily Essentials!</p>
        <button class="cta-btn">Shop Now</button>
      </div>
      <div class="hero-img"></div>
    </section>
    <section>
      <div class="section-title">Featured Categories & Products</div>
      <div class="products-grid" id="productsGrid">
        <!-- Products will be injected here by JavaScript -->
      </div>
    </section>
  </main>
</div>

<footer>
  &copy; 2025 OPEN SHOP | All Rights Reserved | Follow us:
  <span style="font-size:1.2em; margin-left:10px;">üåê</span>
</footer><div id="budgetModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:999;">
  
<div style="background:white; padding:20px; border-radius:10px; width:300px; text-align:center; position:relative;">
    <h3>Enter Your Budget</h3>
    <input type="number" id="budgetInput" placeholder="e.g. 200" style="width: 90%; padding: 8px; margin: 10px 0;">
    <button onclick="findCombinations()">Find</button>
    <button onclick="closeBudgetModal()" style="margin-left:10px;">Close</button>
    <div id="budgetResults" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-auth.js";

  // Firebase config and init
  const firebaseConfig = {
    apiKey: "AIzaSyD3wvj7pLB5AsahfRE_xd4AmEkGfRuEIZ8",
    authDomain: "authentication-app-cf09d.firebaseapp.com",
    databaseURL: "https://authentication-app-cf09d-default-rtdb.firebaseio.com",
    projectId: "authentication-app-cf09d",
    storageBucket: "authentication-app-cf09d.appspot.com",
    messagingSenderId: "82317472416",
    appId: "1:82317472416:web:6d0bc95248ca455c834fc5"
  };
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const auth = getAuth();

  // Handle auth state
  onAuthStateChanged(auth, user => {
    if (user) {
      const uid = user.uid;
      get(child(ref(database), "users/" + uid)).then(snapshot => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          document.getElementById("profileName").textContent = data.username;
          document.getElementById("profileID").textContent = data.customerid;
          document.getElementById("profileEmail").textContent = data.email;
        }
      });
    } else {
      document.getElementById("profileName").textContent = "Guest";
      document.getElementById("profileID").textContent = "N/A";
      document.getElementById("profileEmail").textContent = "Not Logged In";
    }
  });

  // Profile toggle function
  window.toggleProfile = function () {
    const info = document.getElementById("profileInfo");
    info.style.display = info.style.display === "block" ? "none" : "block";
  };

  // Combined products array with images and units for some products
  const products = [
      { name: "Rice", category: "grains", imageUrl:"images/rice.jpeg", price: 50, unit: "per kg", stock: 6 },
      { name: "Wheat flour (Atta)", category: "grains", imageUrl:"images/wheatflour.jpg", price: 40, unit: "per kg", stock: 1 },
      { name: "Lentils (Toor dal,etc.)", category: "grains", imageUrl:"images/Lentils.jpeg", price: 120, unit: "per kg", stock: 0 },
      { name: "Sugar", category: "grains", imageUrl:"images/sugar.jpg", price: 45, unit: "per kg", stock: 10 },
      { name: "Salt", category: "grains", imageUrl:"images/salt.jpeg", price: 20, unit: "per kg", stock: 50 },
      { name: "Cooking oil", category: "grains", imageUrl:"images/oil.jpg", price: 150, unit: "per litre", stock: 12 },
      { name: "Semolina (Rava)", category: "grains", imageUrl:"images/rava.jpg", price: 60, unit: "per kg", stock: 8 },
      { name: "Poha (Flattened rice)", category: "grains", imageUrl:"images/flarice.jpg", price: 55, unit: "per kg", stock: 10 },
      { name: "Maida (Refined flour)", category: "grains", imageUrl:"images/maida.jpeg", price: 45, unit: "per kg", stock: 15 },
      { name: "Besan (Gram flour)", category: "grains", imageUrl:"images/gram.webp", price: 70, unit: "per kg", stock: 7 },
      { name: "Turmeric powder", category: "spices", imageUrl:"images/turmeric.jpeg", price: 100, unit: "per 100g", stock: 22 },
      { name: "Red chili powder", category: "spices", imageUrl:"images/rcp.jpeg", price: 90, unit: "per 100g", stock: 18 },
      { name: "Cumin seeds", category: "spices", imageUrl:"images/cumin.webp", price: 110, unit: "per 100g", stock: 14 },
      { name: "Mustard seeds", category: "spices", imageUrl:"images/mustard.jpeg", price: 80, unit: "per 100g", stock: 12 },
      { name: "Garam masala", category: "spices", imageUrl:"images/garam.webp", price: 120, unit: "per 100g", stock: 9 },
      { name: "Potatoes", category: "veggies", imageUrl:"images/potato.jpeg", price: 30, unit: "per kg", stock: 0 }, // Out of stock
      { name: "Onions", category: "veggies", imageUrl:"images/onion.png", price: 25, unit: "per kg", stock: 35 },
      { name: "Tomatoes", category: "veggies", imageUrl:"images/tomato.webp", price: 40, unit: "per kg", stock: 28 },
      { name: "Garlic", category: "veggies", imageUrl:"images/gc.webp", price: 60, unit: "per 100g", stock: 15 },
      { name: "Green chilies", category: "veggies", imageUrl:"images/gp.jpeg", price: 20, unit: "per 100g", stock: 20 },
      { name: "Seasonal fruits (Bananas, Apples, etc.)", category: "veggies", imageUrl:"images/ab.jpg", price: 80, unit: "per kg", stock: 10 },
      { name: "Leafy greens (Spinach, Coriander, etc.)", category: "veggies", imageUrl:"images/spinach.webp", price: 30, unit: "per bunch", stock: 25 },
      { name: "Milk", category: "dairy", imageUrl:"images/milky.jpeg", price: 50, unit: "per litre", stock: 0 }, // Out of stock
      { name: "Curd/Yogurt", category: "dairy", imageUrl:"images/curd.jpg", price: 45, unit: "per 500g", stock: 12 },
      { name: "Eggs", category: "dairy", imageUrl:"images/egg.jpg", price: 60, unit: "per dozen", stock: 8 },
      { name: "Paneer or Tofu", category: "dairy", imageUrl:"images/paneer.webp", price: 150, unit: "per 500g", stock: 5 },
      { name: "Tea or Coffee", category: "other", imageUrl:"images/tc.avif", price: 120, unit: "per 100g", stock: 15 },
      { name: "Bread or Roti", category: "other", imageUrl:"images/bread.jpg", price: 35, unit: "per pack", stock: 20 },
      { name: "Biscuits or Snacks", category: "other", imageUrl:"images/biscuit.jpeg", price: 40, unit: "per pack", stock: 18 },
      { name: "Soap/Detergent (basic cleaning item)", category: "other", imageUrl:"images/detergent.webp", price: 80, unit: "per bar/packet", stock: 10 },
      { name: "Brown Rice", category: "grains", imageUrl:"images/brownrice.jpg", price: 70, unit: "per kg", stock: 5 },
      { name: "Mustard Oil", category: "grains", imageUrl:"images/moil.jpeg", price: 180, unit: "per litre", stock: 7 },
      { name: "Potato Chips", category: "other", imageUrl:"images/pchips.jpeg", price: 40, unit: "per pack", stock: 0 }, // Out of stock
      { name: "Masala Tea", category: "other", imageUrl:"images/mtea.webp", price: 90, unit: "per 100g", stock: 3 }
  ];

  // Existing code...x

  // Add to cart handler (same as before)
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("add-btn")) {
      const productName = e.target.closest(".product-card").querySelector("h4").textContent;
      const product = products.find(p => p.name === productName);
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");
      cart.push(product);
      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`Added ${productName} to cart!`);
    }
  });

  // Order button click handler
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("order-btn")) {
      const card = e.target.closest(".product-card");
      const productName = card.querySelector("h4").textContent;
      const product = products.find(p => p.name === productName);

      if (product) {
        const orderUrl = `order.html?name=${encodeURIComponent(product.name)}&price=${product.price}&unit=${encodeURIComponent(product.unit || "")}`;
        window.location.href = orderUrl;
      } else {
        alert("Product not found.");
      }
    }
  });

  // On Go to Cart button click, redirect to cart page
  document.getElementById("goToCartBtn").addEventListener("click", function () {
    window.location.href = "cart.html";  // Change if your cart page has a different name
  });

  document.getElementById("goToBudget").addEventListener("click", function () {
  window.location.href = "budget.html";  // Change if your cart page has a different name
  });

  // Mapping for tags display text
  const categoryTags = {
    grains: "Grains & Staples",
    spices: "Spices",
    veggies: "Veggies & Fruits",
    dairy: "Dairy & Protein",
    other: "Essentials"
  };

  // Render product cards with image if available
// Add this near the top with other DOM element references
const filterBtn = document.getElementById("filterBtn");
const filterDropdown = document.querySelector(".filter-dropdown");

// Toggle filter dropdown
filterBtn.addEventListener("click", function(e) {
  e.stopPropagation();
  filterDropdown.classList.toggle("show");
});

// Close filter dropdown when clicking outside
document.addEventListener("click", function() {
  filterDropdown.classList.remove("show");
});

// Prevent dropdown from closing when clicking inside it
filterDropdown.addEventListener("click", function(e) {
  e.stopPropagation();
});

// Price filter change handler
document.querySelectorAll('input[name="priceFilter"]').forEach(radio => {
  radio.addEventListener("change", function() {
    applyFilters();
  });
});

// Function to apply all active filters
function applyFilters() {
  const activeCat = document.querySelector(".categories-list li.active")?.dataset.category || "all";
  const searchTerm = document.getElementById("searchInput").value;
  const priceFilter = document.querySelector('input[name="priceFilter"]:checked').value;
  
  renderProducts(activeCat, searchTerm, priceFilter);
}

// Modified renderProducts function to include price filtering
  function renderProducts(filterCategory = "all", searchTerm = "", priceFilter = "all") {
    const grid = document.getElementById("productsGrid");
    grid.innerHTML = "";

    let filtered = products.filter(p =>
      (filterCategory === "all" || p.category === filterCategory) &&
      p.name.toLowerCase().includes(searchTerm.toLowerCase())
    );

    // Apply price filter
    if (priceFilter !== "all") {
      filtered = filtered.filter(p => {
        if (priceFilter === "0-50") return p.price <= 50;
        if (priceFilter === "50-100") return p.price > 50 && p.price <= 100;
        if (priceFilter === "100-150") return p.price > 100 && p.price <= 150;
        if (priceFilter === "150-200") return p.price > 150 && p.price <= 200;
        if (priceFilter === "200+") return p.price > 200;
        return true;
      });
    }

    if (filtered.length === 0) {
      grid.innerHTML = "<div style='padding:2rem;font-size:1.2rem;'>No products found.</div>";
      return;
    }

    filtered.forEach(p => {
      const tagText = categoryTags[p.category] || p.category;
      const stockStatus = p.stock <= 0 ? "Out of Stock" : 
                         p.stock <= 5 ? "Low Stock" : "In Stock";
      const stockClass = p.stock <= 0 ? "out-of-stock" : 
                        p.stock <= 5 ? "low-stock" : "in-stock";
      const isOutOfStock = p.stock <= 0;

      grid.innerHTML += `
        <div class="product-card">
          ${p.imageUrl ? `<img src="${p.imageUrl}" alt="${p.name}" class="product-image" />` : ""}
          <span class="tag">${tagText}</span>
          <span class="stock-status ${stockClass}">${stockStatus}</span>
          <h4>${p.name}</h4>
          <p class="price">‚Çπ${p.price.toFixed(2)} <small>${p.unit || ""}</small></p>
          <div class="button-group">
            <button class="add-btn" ${isOutOfStock ? 'disabled' : ''}>Add to Cart</button>
            <button class="order-btn ${isOutOfStock ? 'disabled-btn' : ''}" ${isOutOfStock ? 'disabled' : ''}>Order</button>
          </div>
          ${isOutOfStock ? '<div style="color:#e74c3c;font-size:0.9rem;margin-top:5px;">Currently unavailable</div>' : ''}
        </div>
      `;
    });
  }

  // Modified order button click handler with stock check
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("order-btn") && !e.target.classList.contains("disabled-btn")) {
      const card = e.target.closest(".product-card");
      const productName = card.querySelector("h4").textContent;
      const product = products.find(p => p.name === productName);

      if (product) {
        if (product.stock <= 0) {
          alert("This product is currently out of stock.");
          return;
        }
        
        // Reduce stock by 1 when ordering
        product.stock -= 1;
        
        const orderUrl = `order.html?name=${encodeURIComponent(product.name)}&price=${product.price}&unit=${encodeURIComponent(product.unit || "")}`;
        window.location.href = orderUrl;
      } else {
        alert("Product not found.");
      }
    }
  });

  // Modified add to cart handler with stock check
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("add-btn") && !e.target.disabled) {
      const productName = e.target.closest(".product-card").querySelector("h4").textContent;
      const product = products.find(p => p.name === productName);
      
      if (product.stock <= 0) {
        alert("This product is currently out of stock.");
        return;
      }
      
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");
      cart.push(product);
      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`Added ${productName} to cart!`);
      
      // Optional: Reduce stock when adding to cart (uncomment if you want this behavior)
      // product.stock -= 1;
      // renderProducts(); // Refresh the display
    }
  });
// Update existing event listeners to use applyFilters()
document.getElementById("categoryList").addEventListener("click", function (e) {
  if (e.target.tagName === "LI") {
    document.querySelectorAll(".categories-list li").forEach(li => li.classList.remove("active"));
    e.target.classList.add("active");
    applyFilters();
  }
});

document.getElementById("searchInput").addEventListener("input", function () {
  applyFilters();
});

   // Initial render with all products
  renderProducts();

</script>

</body>
</html>    
