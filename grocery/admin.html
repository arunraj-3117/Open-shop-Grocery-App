<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body, html {
      height: 100%;
      background: #121212;
      color: #e0e0e0;
    }
    .container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    .sidebar {
      width: 80px;
      background: #1f1f1f;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0;
      border-right: 2px solid #333;
    }
    .sidebar button {
      background: none;
      border: none;
      color: #bbb;
      margin: 1rem 0;
      font-size: 1.8rem;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .sidebar button.active,
    .sidebar button:hover {
      color: #00ffd5;
    }
    .sidebar button:focus {
      outline: 2px solid #00ffd5;
      outline-offset: 2px;
    }
    .main {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      background: #181818;
      padding: 1.5rem 2rem;
      overflow-y: auto;
    }
    .hero {
      font-size: 2rem;
      padding-bottom: 1rem;
      border-bottom: 2px solid #333;
      margin-bottom: 1rem;
      color: #00ffd5;
      font-weight: 600;
      user-select: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: #222;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,255,213,0.2);
      table-layout: auto;
    }
    thead {
      background: #00ffd5;
      color: #111;
    }
    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid #333;
      text-align: left;
      font-size: 0.9rem;
      word-break: break-word;
    }
    tbody tr:hover {
      background: #333;
    }
    .logins-list {
      max-height: 100px;
      overflow-y: auto;
      padding-right: 6px;
    }
    .logins-list p {
      font-size: 0.8rem;
      margin: 0;
      padding: 2px 0;
      color: #a0f0e0;
      user-select: text;
    }
    .logins-list::-webkit-scrollbar {
      width: 6px;
    }
    .logins-list::-webkit-scrollbar-thumb {
      background: #00ffd5;
      border-radius: 3px;
    }
    .password-mask {
      -webkit-text-security: disc;
      text-security: disc;
    }
    .order-card {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      background-color: #fff;
      font-family: Arial, sans-serif;
    }

    .order-card h3 {
      margin-top: 0;
      color: #333;
    }

    .order-card p {
      margin: 5px 0;
      color: #555;
    }

    .order-card ul {
      padding-left: 20px;
      margin-top: 5px;
      color: #444;
    }

    .order-card ul li {
      margin-bottom: 3px;
    }

  </style>
</head>
<body>

<div class="container">
  <nav class="sidebar" role="navigation" aria-label="Admin Dashboard Navigation">
    <button id="btnUsers" class="active" title="Users" aria-pressed="true" aria-label="Show Users">üë•</button>
    <button id="btnOrders" title="Orders" aria-pressed="false" aria-label="Show Orders">üì¶</button>
    <button id="btnComboOrders" title="Combo Orders" aria-pressed="false" aria-label="Show Combo Orders">üõí</button>
    <button id="btnCartOrders" title="Cart Orders" aria-pressed="false" aria-label="Show Cart Orders">üõçÔ∏è</button>
  </nav>

  <main class="main" role="main">
    <div class="hero" id="heroText">Hi, Admin, welcome to dashboard</div>
    <section id="contentArea" aria-live="polite" aria-busy="false">
      <!-- Table will load here -->
    </section>
  </main>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/11.7.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD3wvj7pLB5AsahfRE_xd4AmEkGfRuEIZ8",
    authDomain: "authentication-app-cf09d.firebaseapp.com",
    databaseURL: "https://authentication-app-cf09d-default-rtdb.firebaseio.com",
    projectId: "authentication-app-cf09d",
    storageBucket: "authentication-app-cf09d.appspot.com",
    messagingSenderId: "82317472416",
    appId: "1:82317472416:web:6d0bc95248ca455c834fc5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // Get buttons and elements once at the start
  const btnUsers      = document.getElementById("btnUsers");
  const btnOrders     = document.getElementById("btnOrders");
  const btnComboOrders= document.getElementById("btnComboOrders");
  const contentArea   = document.getElementById("contentArea");
  const heroText      = document.getElementById("heroText");

  function clearActive() {
    [btnUsers, btnOrders, btnComboOrders].forEach(btn => {
      if (btn) {
        btn.classList.remove("active");
        btn.setAttribute("aria-pressed", "false");
      }
    });
  }

  // ‚Äî‚Äî‚Äî USERS ‚Äî‚Äî‚Äî
  async function showUsers() {
    clearActive();
    btnUsers.classList.add("active");
    btnUsers.setAttribute("aria-pressed", "true");
    heroText.textContent = "User Management";
    contentArea.setAttribute("aria-busy", "true");
    contentArea.innerHTML = "<p>Loading users...</p>";

    try {
      const snap = await get(child(ref(db), "users"));
      if (!snap.exists()) {
        contentArea.innerHTML = "<p>No users found.</p>";
        return;
      }

      const users = snap.val();
      let html = `
        <table>
          <thead>
            <tr>
              <th>Customer ID</th><th>Email</th><th>Password</th>
              <th>Username</th><th>Signup Time</th><th>Login Times</th>
            </tr>
          </thead><tbody>
      `;

      for (const uid in users) {
        const u = users[uid];
        const logins = u.logins || {};
        const times = Object.values(logins).map(l => l.login_time || "N/A");
        const loginHTML = times.length
          ? `<div class="logins-list" tabindex="0">${times.map(t => `<p>${t}</p>`).join("")}</div>`
          : "No logins";

        html += `
          <tr>
            <td>${u.customerid || uid}</td>
            <td>${u.email || "N/A"}</td>
            <td>${u.password || "N/A"}</td>
            <td>${u.username || "N/A"}</td>
            <td>${u.registration_time || "N/A"}</td>
            <td>${loginHTML}</td>
          </tr>
        `;
      }
      html += "</tbody></table>";
      contentArea.innerHTML = html;
    } catch (err) {
      contentArea.innerHTML = `<p style="color:red;">Error loading users: ${err.message}</p>`;
    } finally {
      contentArea.setAttribute("aria-busy", "false");
    }
  }

  // ‚Äî‚Äî‚Äî ORDERS ‚Äî‚Äî‚Äî
  async function showOrders() {
    clearActive();
    btnOrders.classList.add("active");
    btnOrders.setAttribute("aria-pressed", "true");
    heroText.textContent = "Orders Management";
    contentArea.setAttribute("aria-busy", "true");
    contentArea.innerHTML = "<p>Loading orders...</p>";

    try {
      const snapshot = await get(child(ref(db), "orders"));
      if (!snapshot.exists()) {
        contentArea.innerHTML = "<p>No orders found.</p>";
        return;
      }

      const ordersData = snapshot.val();
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>Customer ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Product</th>
              <th>Quantity</th>
              <th>Unit</th>
              <th>Total (‚Çπ)</th>
              <th>Method</th>
              <th>Mobile</th>
              <th>Address</th>
              <th>Timestamp</th>
            </tr>
          </thead>
          <tbody>
      `;

      for (const userId in ordersData) {
        const userOrders = ordersData[userId];

        for (const orderId in userOrders) {
          const order = userOrders[orderId];
          tableHTML += `
            <tr>
              <td>${order.customerid || userId}</td>
              <td>${order.name || "N/A"}</td>
              <td>${order.email || "N/A"}</td>
              <td>${order.product || "N/A"}</td>
              <td>${order.quantity || 0}</td>
              <td>${order.unit || ""}</td>
              <td>‚Çπ ${order.totalAmount || 0}</td>
              <td>${order.method || "N/A"}</td>
              <td>${order.mobile || "N/A"}</td>
              <td>${order.address || "N/A"}</td>
              <td>${order.timestamp || "N/A"}</td>
            </tr>
          `;
        }
      }

      tableHTML += "</tbody></table>";
      contentArea.innerHTML = tableHTML;
    } catch (error) {
      contentArea.innerHTML = `<p style="color:red;">Error loading orders: ${error.message}</p>`;
    } finally {
      contentArea.setAttribute("aria-busy", "false");
    }
  }

  // ‚Äî‚Äî‚Äî COMBO ORDERS ‚Äî‚Äî‚Äî
  async function showComboOrders() {
    clearActive();
    btnComboOrders.classList.add("active");
    btnComboOrders.setAttribute("aria-pressed", "true");
    heroText.textContent = "Combo Orders Management";
    contentArea.setAttribute("aria-busy", "true");
    contentArea.innerHTML = "<p>Loading combo orders...</p>";

    try {
      const snapshot = await get(child(ref(db), "combo_orders"));
      if (!snapshot.exists()) {
        contentArea.innerHTML = "<p>No combo orders found.</p>";
        return;
      }

      const comboOrdersData = snapshot.val();
      let html = "";

      for (const orderId in comboOrdersData) {
        const order = comboOrdersData[orderId];
        const customer = order.customer || {};
        const orderDetails = order.orderDetails || [];

        html += `
          <div class="order-card" style="border:1px solid #ccc; padding:10px; margin-bottom:15px; border-radius:10px;">
            <h3>Order ID: ${orderId}</h3>
            <p><strong>Name:</strong> ${customer.name || "N/A"}</p>
            <p><strong>Address:</strong> ${customer.address || "N/A"}</p>
            <p><strong>Phone:</strong> ${customer.phone || "N/A"}</p>
            <h4>Items Ordered:</h4>
            <table style="width:100%; border-collapse:collapse;">
              <thead>
                <tr>
                  <th style="border-bottom:1px solid #999;">#</th>
                  <th style="border-bottom:1px solid #999;">Item Name</th>
                  <th style="border-bottom:1px solid #999;">Quantity</th>
                  <th style="border-bottom:1px solid #999;">Unit Price (‚Çπ)</th>
                  <th style="border-bottom:1px solid #999;">Amount (‚Çπ)</th>
                </tr>
              </thead>
              <tbody>
        `;

        orderDetails.forEach((item, index) => {
          html += `
            <tr>
              <td>${index + 1}</td>
              <td>${item.name || "N/A"}</td>
              <td>${item.quantity || 0}</td>
              <td>‚Çπ ${item.unitPrice || 0}</td>
              <td>‚Çπ ${item.amount || 0}</td>
            </tr>
          `;
        });

        html += `
              </tbody>
            </table>
          </div>
        `;
      }

      contentArea.innerHTML = html;
    } catch (error) {
      contentArea.innerHTML = `<p style="color:red;">Error loading combo orders: ${error.message}</p>`;
    } finally {
      contentArea.setAttribute("aria-busy", "false");
    }
  }

  // ‚Äî‚Äî‚Äî CART ORDERS ‚Äî‚Äî‚Äî
  btnCartOrders.addEventListener("click", showCartOrders);

  async function showCartOrders() {
    clearActive();
    btnCartOrders.classList.add("active");
    btnCartOrders.setAttribute("aria-pressed", "true");
    heroText.textContent = "Cart Orders Management";
    contentArea.setAttribute("aria-busy", "true");
    contentArea.innerHTML = "<p>Loading cart orders...</p>";

    try {
      const snapshot = await get(child(ref(db), "cart_orders"));
      if (!snapshot.exists()) {
        contentArea.innerHTML = "<p>No cart orders found.</p>";
        return;
      }

      const cartOrdersData = snapshot.val();
      let cardsHTML = "";

      for (const orderId in cartOrdersData) {
        const order = cartOrdersData[orderId];
        const customerId = order.customerId || "N/A";
        const name = order.name || "N/A";
        const email = order.email || "N/A";
        const mobile = order.mobile || "N/A";
        const address = order.address || "N/A";
        const paymentMethod = order.paymentMethod || "N/A";
        const grandTotal = order.grandTotal || "N/A";
        const orderDate = order.orderDate ? new Date(order.orderDate).toLocaleString() : "N/A";
        const products = order.products || [];

        // Build product list as <li> items
        const productsList = products.map(p => {
          const pname = p.name || "N/A";
          const price = p.price || 0;
          const unit = p.unit || "";
          return `<li>${pname} - ‚Çπ${price} ${unit}</li>`;
        }).join("");

        cardsHTML += `
          <div class="order-card" style="
            border: 1px solid #ccc; 
            padding: 15px; 
            margin-bottom: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-width: 600px;
          ">
            <h3>Order ID: ${orderId}</h3>
            <p><strong>Customer ID:</strong> ${customerId}</p>
            <p><strong>Name:</strong> ${name}</p>
            <p><strong>Email:</strong> ${email}</p>
            <p><strong>Mobile:</strong> ${mobile}</p>
            <p><strong>Address:</strong> ${address}</p>
            <p><strong>Payment Method:</strong> ${paymentMethod}</p>
            <p><strong>Order Date:</strong> ${orderDate}</p>
            <p><strong>Grand Total:</strong> ‚Çπ${grandTotal}</p>
            <p><strong>Products:</strong></p>
            <ul>${productsList}</ul>
          </div>
        `;
      }

      contentArea.innerHTML = cardsHTML;
    } catch (error) {
      contentArea.innerHTML = `<p style="color:red;">Error loading cart orders: ${error.message}</p>`;
    } finally {
      contentArea.setAttribute("aria-busy", "false");
    }
  }

  // Attach all click handlers
  btnUsers.addEventListener("click", showUsers);
  btnOrders.addEventListener("click", showOrders);
  btnComboOrders.addEventListener("click", showComboOrders);
  btnCartOrders.addEventListener("click", showCartOrders); // <‚Äî this is essential


  // Initial load
  showUsers();
</script>
</body>
</html>
